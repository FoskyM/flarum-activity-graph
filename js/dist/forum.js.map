{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@foskym/flarum-activity-graph/webpack/bootstrap","webpack://@foskym/flarum-activity-graph/webpack/runtime/compat get default export","webpack://@foskym/flarum-activity-graph/webpack/runtime/define property getters","webpack://@foskym/flarum-activity-graph/webpack/runtime/hasOwnProperty shorthand","webpack://@foskym/flarum-activity-graph/webpack/runtime/make namespace object","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['common/app']\"","webpack://@foskym/flarum-activity-graph/./src/common/index.ts","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['forum/app']\"","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['common/extend']\"","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['forum/components/UserPage']\"","webpack://@foskym/flarum-activity-graph/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['common/components/Select']\"","webpack://@foskym/flarum-activity-graph/./src/forum/pages/GraphPage.js","webpack://@foskym/flarum-activity-graph/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@foskym/flarum-activity-graph/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@foskym/flarum-activity-graph/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('foskym/flarum-activity-graph', () => {\n  console.log('[foskym/flarum-activity-graph] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserPage'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Select'];","import app from 'flarum/forum/app';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Select from 'flarum/common/components/Select';\n\nexport default class AuthorizedPage extends UserPage {\n  loading = true;\n  year = new Date().getFullYear().toString();\n  graphData = null;\n  categories = null;\n  total = 0;\n  graph = null;\n  resize_handler_bound = false;\n  dark_mode_handler_bound = false;\n  recent_mode = 'light';\n\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.loadUser(m.route.param('username'));\n    this.loadGraph();\n  }\n\n  loadGraph() {\n    this.loading = true;\n\n    app\n      .request({\n        method: 'GET',\n        url: app.forum.attribute('apiUrl') + '/activity-graph',\n        params: { user_id: this.user.id(), year: this.year },\n      })\n      .then((result) => {\n        this.loading = false;\n        this.graphData = result.data;\n        this.categories = result.categories;\n        this.total = result.total;\n        m.redraw();\n        this.renderGraph();\n      });\n  }\n\n  renderGraph() {\n    if (!window.echarts) {\n      setTimeout(() => this.renderGraph(), 200);\n      return;\n    }\n\n    const graph_container = document.getElementById('activity-graph');\n    if (!graph_container) return;\n\n    setTimeout(() => {\n      const root = document.documentElement;\n      const colorScheme = getComputedStyle(root).getPropertyValue('--color-scheme').trim();\n      const bodyBg = getComputedStyle(root).getPropertyValue('--body-bg').trim();\n      console.log(colorScheme, bodyBg);\n      if (colorScheme != this.recent_mode) {\n        this.recent_mode = colorScheme;\n        if (this.chart) {\n          this.chart.dispose();\n          this.chart = null;\n        }\n        this.chart = window.echarts.init(graph_container, colorScheme == 'dark' ? 'dark' : 'light');\n      } else {\n        this.chart = this.chart || window.echarts.init(graph_container);\n      }\n      const that = this;\n      this.chart.setOption({\n        backgroundColor: bodyBg,\n        tooltip: {\n          position: 'top',\n          className: 'foskym-activity-graph-tooltip',\n          formatter: function (e) {\n            let date = e.data[0];\n            let total = e.data[1];\n            let unit = app.translator.trans('foskym-activity-graph.forum.label.unit');\n            let html = '<p>' + e.marker + date.substring(5) + ' <b>' + total + ' ' + unit + '</b></p>';\n            ['comments', 'discussions', 'likes'].forEach((category) => {\n              if (that.categories[category][date]) {\n                html +=\n                  '<p><small>' +\n                  app.translator.trans('foskym-activity-graph.forum.label.categories.' + category) +\n                  ' <b>' +\n                  that.categories[category][date] +\n                  ' ' +\n                  unit +\n                  '</b></small></p>';\n              }\n            });\n            return html;\n          },\n        },\n        visualMap: {\n          show: !1,\n          min: 0,\n          max: 300,\n          calculable: !0,\n          orient: 'horizontal',\n          left: 'center',\n          top: 'top',\n          inRange: {\n            color: ['#75ca67', '#23b20c', '#b99f11', '#b81111', '#6c0b0b', '#000000'],\n          },\n        },\n        calendar: [\n          {\n            range: this.year,\n            cellSize: ['auto', 'auto'],\n            left: 50,\n            top: 30,\n            splitLine: {\n              lineStyle: {\n                color: '#777',\n              },\n            },\n            dayLabel: {\n              nameMap: app.translator.trans('foskym-activity-graph.forum.label.name_map')[0],\n              firstDay: 1,\n            },\n            monthLabel: {\n              nameMap: app.translator.trans('foskym-activity-graph.forum.label.name_map')[0],\n            },\n            yearLabel: {\n              show: !0,\n            },\n          },\n        ],\n        series: [\n          {\n            type: 'heatmap',\n            coordinateSystem: 'calendar',\n            calendarIndex: 0,\n            data: this.graphData,\n          },\n        ],\n      });\n\n      if (!this.resize_handler_bound) {\n        window.addEventListener('resize', () => {\n          this.chart.resize();\n        });\n        this.resize_handler_bound = true;\n      }\n\n      if (!this.dark_mode_handler_bound) {\n        if (flarum.extensions['fof-nightmode']) {\n          document.addEventListener('fofnightmodechange', (event) => {\n            console.log(event.detail);\n            this.renderGraph();\n          });\n        }\n        this.dark_mode_handler_bound = true;\n      }\n    }, 50);\n  }\n\n  content() {\n    let options = {};\n    for (let i = 0; i < 10; i++) {\n      let year = (new Date().getFullYear() - i).toString();\n      options[year] = year;\n    }\n\n    return (\n      <div class=\"activity-graph-page\">\n        <h2>{app.translator.trans('foskym-activity-graph.forum.label.activity_graph')}</h2>\n        <div style=\"display: flex; justify-content: space-between; align-items: end;\">\n          <span>{app.translator.trans('foskym-activity-graph.forum.label.total_times', { total: this.total })}</span>\n          <Select\n            options={options}\n            value={this.year}\n            onchange={(value) => {\n              this.year = value;\n              this.loadGraph();\n            }}\n          ></Select>\n        </div>\n\n        <div id=\"activity-graph\" style=\"width:100%; height:150px;\"></div>\n      </div>\n    );\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","import app from 'flarum/forum/app';\nimport {extend} from 'flarum/common/extend';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport GraphPage from \"./pages/GraphPage\";\nimport LinkButton from 'flarum/common/components/LinkButton';\napp.initializers.add('foskym/flarum-activity-graph', () => {\n  app.routes['user.activity-graph'] = {\n    path: '/u/:username/activity-graph',\n    component: GraphPage\n  };\n  extend(UserPage.prototype, 'navItems', function (items) {\n    items.add(\n      'activity-graph',\n      LinkButton.component(\n        {\n          href: app.route('user.activity-graph', { username: this.user.username() }),\n          icon: 'fas fa-chart-line',\n        },\n        [\n          app.translator.trans('foskym-activity-graph.forum.label.activity_graph'),\n        ]\n      )\n    );\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","console","log","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","AuthorizedPage","_UserPage","subClass","superClass","_this","_len","arguments","length","args","Array","_key","apply","concat","loading","year","Date","getFullYear","toString","graphData","categories","total","graph","resize_handler_bound","dark_mode_handler_bound","recent_mode","create","constructor","_proto","oninit","vnode","this","loadUser","m","route","param","loadGraph","_this2","method","url","attribute","params","user_id","user","id","then","result","data","redraw","renderGraph","_this3","window","echarts","graph_container","document","getElementById","setTimeout","root","documentElement","colorScheme","getComputedStyle","getPropertyValue","trim","bodyBg","chart","dispose","init","that","setOption","backgroundColor","tooltip","position","className","formatter","e","date","unit","trans","html","marker","substring","forEach","category","visualMap","show","min","max","calculable","orient","left","top","inRange","color","calendar","range","cellSize","splitLine","lineStyle","dayLabel","nameMap","firstDay","monthLabel","yearLabel","series","type","coordinateSystem","calendarIndex","addEventListener","resize","extensions","event","detail","content","_this4","options","i","class","style","Select","onchange","UserPage","path","component","GraphPage","extend","items","LinkButton","href","username","icon"],"sourceRoot":""}