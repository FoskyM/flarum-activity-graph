(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const a=flarum.core.compat["common/app"];t.n(a)().initializers.add("foskym/flarum-activity-graph",(function(){console.log("[foskym/flarum-activity-graph] Hello, forum and admin!")}));const r=flarum.core.compat["forum/app"];var o=t.n(r);const n=flarum.core.compat["common/extend"],i=flarum.core.compat["forum/components/UserPage"];var s=t.n(i);function c(){return c=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},c.apply(this,arguments)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}const u=flarum.core.compat["common/components/LoadingIndicator"];var p=t.n(u);const d=flarum.core.compat["common/components/Select"];var f=t.n(d);const h=flarum.core.compat["common/utils/extractText"];var y=t.n(h),g=["comments","discussions","likes","custom_levels_exp_logs","invite_user_invites","store_purchases","polls_create_polls","polls_votes","username_requests_username","username_requests_nickname","best_answer_marked","badges_assigned","achievements_achieved","quest_done"],v=function(t){var e,a;function r(){for(var e,a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).loading=!0,e.year=(new Date).getFullYear().toString(),e.graphData=null,e.categories=null,e.total=0,e.chart=null,e.resizeHandlerBound=!1,e.darkModeHandlerBound=!1,e.recentMode="light",e}a=t,(e=r).prototype=Object.create(a.prototype),e.prototype.constructor=e,l(e,a);var n=r.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loadUser(m.route.param("username")),this.loadGraph()},n.loadGraph=function(){var t=this;this.loading=!0,o().request({method:"GET",url:o().forum.attribute("apiUrl")+"/activity-graph",params:{user_id:this.user.id(),year:this.year}}).then((function(e){t.loading=!1,t.graphData=e.data,t.categories=e.categories,t.total=e.total,m.redraw(),t.renderGraph()}))},n.renderGraph=function(){var t=this;if(window.echarts){var e=document.getElementById("activity-graph");e&&setTimeout((function(){var a,r=document.documentElement,o=getComputedStyle(r).getPropertyValue("--color-scheme").trim(),n=getComputedStyle(r).getPropertyValue("--body-bg").trim();o!==t.recentMode?(t.recentMode=o,null==(a=t.chart)||a.dispose(),t.chart=window.echarts.init(e,"dark"===o?"dark":"light")):t.chart=t.chart||window.echarts.init(e),t.chart.setOption(t.getChartOptions(n)),t.resizeHandlerBound||(window.addEventListener("resize",(function(){return t.chart.resize()})),t.resizeHandlerBound=!0),!t.darkModeHandlerBound&&flarum.extensions["fof-nightmode"]&&(document.addEventListener("fofnightmodechange",(function(){return t.renderGraph()})),t.darkModeHandlerBound=!0)}),50)}else setTimeout((function(){return t.renderGraph()}),200)},n.getChartOptions=function(t){var e=this;return{backgroundColor:t,tooltip:{position:o().forum.attribute("foskym-activity-graph.tooltip_position")||"top",className:"foskym-activity-graph-tooltip",formatter:function(t){return e.formatTooltip(t)}},visualMap:{show:!1,min:0,max:300,calculable:!0,orient:"horizontal",left:"center",top:"top",inRange:{color:["#75ca67","#23b20c","#b99f11","#b81111","#6c0b0b","#000000"]}},calendar:[{range:this.year,cellSize:["auto","auto"],left:50,top:30,splitLine:{lineStyle:{color:"#777"}},dayLabel:{nameMap:o().translator.trans("foskym-activity-graph.forum.label.name_map")[0],firstDay:1},monthLabel:{nameMap:o().translator.trans("foskym-activity-graph.forum.label.name_map")[0]},yearLabel:{show:!0}}],series:[{type:"heatmap",coordinateSystem:"calendar",calendarIndex:0,data:this.graphData}]}},n.formatTooltip=function(t){var e=this,a=t.data[0],r=t.data[1],n=o().forum.attribute("foskym-activity-graph.times_display_format")||y()(o().translator.trans("foskym-activity-graph.lib.defaults.times_display_format")),i="<p>"+t.marker+a.substring(5)+" <b>"+(n.includes("[count]")?n.replace("[count]",r):r+" "+n)+"</b></p>";return g.forEach((function(t){!1!==o().forum.attribute("foskym-activity-graph.count_"+t)&&e.categories[t]&&e.categories[t][a]&&(i+="<p><small>"+o().translator.trans("foskym-activity-graph.forum.label.categories."+t)+" <b>"+(n.includes("[count]")?n.replace("[count]",e.categories[t][a]):e.categories[t][a]+" "+n)+"</b></small></p>")})),i},n.content=function(){var t=this,e=(new Date).getFullYear().toString(),a=o().forum.attribute("foskym-activity-graph.from_year")||e;a=a>e?e:a;var r=Array.from({length:e-a+1},(function(t,e){return(parseInt(a)+e).toString()})).reduce((function(t,e){var a;return c({},t,((a={})[e]=e,a))}),{}),n=o().forum.attribute("foskym-activity-graph.times_display_format")||y()(o().translator.trans("foskym-activity-graph.lib.defaults.times_display_format")),i=n.includes("[count]")?n.replace("[count]",this.total):this.total+" "+n;return m("div",{class:"activity-graph-page"},m("h2",null,o().translator.trans("foskym-activity-graph.forum.label.activity_graph")),m("div",{style:"display: flex; justify-content: space-between; align-items: end;"},m("span",null,o().translator.trans("foskym-activity-graph.forum.label.total_times",{total:i})),m(f(),{options:r,value:this.year,onchange:function(e){t.year=e,t.loadGraph()}})),this.loading&&m(p(),null),m("div",{id:"activity-graph",style:"width:100%; height:150px;"}))},r}(s());const b=flarum.core.compat["common/components/LinkButton"];var _=t.n(b);o().initializers.add("foskym/flarum-activity-graph",(function(){o().routes["user.activity-graph"]={path:"/u/:username/activity-graph",component:v},(0,n.extend)(s().prototype,"navItems",(function(t){var e;t.add("activity-graph",_().component({href:o().route("user.activity-graph",{username:null==(e=this.user)?void 0:e.username()}),icon:"fas fa-chart-line"},[o().translator.trans("foskym-activity-graph.forum.label.activity_graph")]))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map